<link href='https://fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
<link rel="import" href="ts-transformer.html">

<style>
	.transcript {
		text-rendering: optimizeLegibility;
		font-family: 'Merriweather', serif;
		text-align: justify;
		line-height: 1.8em;
		overflow-wrap: break-word;
		word-wrap: break-word;
		margin: 0;
		padding: 0;
	}

	.transcript P {
		margin: 0;
		padding-top: 0;
		padding-bottom: 0.5em;
	}

	.transcript H1 {
		font-size: 120%;
		font-weight: bold;
		margin: 0;
		padding-top: 1.5em;
		padding-bottom: 1em;
	}

	.transcript H3 {
		font-size: 100%;
		font-weight: bold;
		margin: 0;
		padding-top: 1em;
		padding-bottom: 0.5em;
	}

	.transcript UL {
		margin: 0;
		padding-top: 0.2em;
		padding-bottom: 0.2em;
	}

	.transcript UL P {
		margin: 0;
		padding-bottom: 0.5em;
	}

</style>

<dom-module id="ts-transcript">
<template>
	<style>

	:host {
		@apply(--layout-vertical);
		display: block;
		min-height: 100%;
		font-size: 110%;
	}

	#container {
		@apply(--layout-flex);
	}

	#container li p {
		@apply(--transcript-choice);
	}

	#blank {
		height: 100vh;
	}

	#textbox {
		position: fixed;
		bottom: 1em;
		left: 1em;
		right: 1em;
	}
	</style>

	<div id="container" class="transcript"></div>
	<div id="blank"></div>
</template>
<script>
(function () {
"use strict";

function divWithClass(c) {
	let e = document.createElement("DIV");
	Polymer.dom(e).setAttribute("class", c);
	return e;
}

function empty(element) {
	for (;;) {
		let child = Polymer.dom(element).firstChild;
		if (!child)
			break;
		Polymer.dom(element).removeChild(child);
	}
}

function appendTextNode(paragraph, text) {
	let t = document.createTextNode(text);
	paragraph.appendChild(t);
}

Polymer({
	is: "ts-transcript",

	ready: function() {
		this._room = null;
		this._title = null;
		this._body = null;
		this._choices = null;
	},

	newRoom: function(room) {
		let $ = this.$;

		if (this._choices != null)
			Polymer.dom(this._room).removeChild(this._choices);

		this._room = divWithClass("room");
		this._title = document.createElement("H1");
		this._body = document.createElement("ts-transformer");
		this._choices = document.createElement("DIV");

		Polymer.dom($.container).appendChild(this._room);
		Polymer.dom(this._room).appendChild(this._title);
		Polymer.dom(this._room).appendChild(this._body);
		Polymer.dom(this._room).appendChild(this._choices);

		this.updateRoom(room);
	},

	updateRoom: function(room) {
		empty(this._title);

		let parsed = room.parsed;

		appendTextNode(this._title, room.title);

		empty(this._choices);
		if (parsed.choicesDom != null)
			Polymer.dom(this._choices).appendChild(parsed.choicesDom);

		this._body.content = parsed.dom;
	},

	append: function(event) {
		Polymer.dom(this._room).removeChild(this._choices);

		let t = divWithClass("chunk");
		let n = document.createTextNode(event.text);
		t.appendChild(n);
		Polymer.dom(this._room).appendChild(t);

		Polymer.dom(this._room).appendChild(this._choices);
	}
});

})();
</script>
</dom-module>

